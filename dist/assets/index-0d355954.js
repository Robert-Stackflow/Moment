var U=(x,c,s)=>new Promise((d,_)=>{var p=n=>{try{y(s.next(n))}catch(u){_(u)}},f=n=>{try{y(s.throw(n))}catch(u){_(u)}},y=n=>n.done?d(n.value):Promise.resolve(n.value).then(p,f);y((s=s.apply(x,c)).next())});import{_ as B,N as V,a as g}from"./CommonPage-bbca3a22.js";import{u as A,_ as L,N as O,c as j,d as E}from"./useCRUD-af2c1fcd.js";import{_ as G,a as C}from"./TheIcon-fd522b76.js";import{r as v,ai as M,as as b,o as Q,P as D,Q as z,R as r,a7 as h,U as e,aG as k,$ as i,X,Y,ax as H,h as m,dk as J}from"./index-71df545f.js";import{_ as K}from"./InputNumber-41b056e8.js";import{N as w}from"./Input-7bf44288.js";import"./format-length-c9d165c6.js";import"./use-locale-b5fb7986.js";import"./AppPage-90bf1bc9.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Popover-3620166f.js";import"./Tag-ef52fed7.js";import"./Select-26e3d3e9.js";import"./Space-f0461c01.js";import"./ArrowDown-0e798cc5.js";import"./Dropdown-1844784f.js";import"./Tooltip-86f1074b.js";import"./Remove-20a30d7f.js";import"./Add-af88e723.js";const be=Object.assign({name:"分类管理"},{__name:"index",setup(x){const c=v(null),s=v({}),d=M("permission"),_=v(!1),p={order:1},{modalVisible:f,modalTitle:y,modalLoading:n,handleAdd:u,handleDelete:S,handleEdit:q,handleSave:F,modalForm:o,modalFormRef:I}=A({name:"分类",initForm:p,doCreate:b.createCategory,doDelete:b.deleteCategory,doUpdate:b.updateCategory,refresh:()=>{var t;return(t=c.value)==null?void 0:t.handleSearch()}});Q(()=>{var t;(t=c.value)==null||t.handleSearch(),N()});const R=v(!1),$=v([]),T=[{title:"ID",key:"id",width:50,ellipsis:{tooltip:!0}},{title:"分类名称",key:"name",width:80,ellipsis:{tooltip:!0}},{title:"分类别名",key:"alias",width:80,ellipsis:{tooltip:!0}},{title:"分类描述",key:"desc",width:80,ellipsis:{tooltip:!0}},{title:"排序",key:"order",width:30,ellipsis:{tooltip:!0}},{title:"创建日期",key:"created_at",width:70,render(t){return m("span",J(t.created_at))}},{title:"操作",key:"actions",width:80,align:"center",fixed:"right",render(t){return[h(m(k,{size:"tiny",type:"primary",style:`display: ${t.children?"":"none"};margin-left:5px;`,onClick:()=>{p.parent_id=t.id,u()}},{default:()=>"子分类",icon:C("material-symbols:add",{size:16})}),[[d,"post/api/v1/category/create"]]),h(m(k,{size:"tiny",type:"info",style:"margin-left:5px;",onClick:()=>{R.value=!1,q(t)}},{default:()=>"编辑",icon:C("material-symbols:edit-outline",{size:16})}),[[d,"post/api/v1/category/update"]]),m(E,{onPositiveClick:()=>S({id:t.id},!1)},{trigger:()=>h(m(k,{size:"tiny",type:"error",style:`display: ${t.children&&t.children.length>0?"none":""};margin-left:5px;`},{default:()=>"删除",icon:C("material-symbols:delete-outline",{size:16})}),[[d,"delete/api/v1/category/delete"]]),default:()=>m("div",{},"确定删除该分类吗?")})]}}];function P(){p.parent_id=0,p.order=1,u()}function N(){return U(this,null,function*(){const{data:t}=yield b.getCategories(),a={id:0,name:"根目录",children:[]};a.children=t,$.value=[a]})}return(t,a)=>(D(),z(B,{"show-footer":"",title:t.$t("views.content.label_category_list")},{action:r(()=>[h((D(),z(e(k),{type:"primary",onClick:P},{default:r(()=>[i(G,{icon:"material-symbols:add",size:18,class:"mr-5"}),X(Y(t.$t("views.content.label_new_root_category")),1)]),_:1})),[[e(d),"post/api/v1/category/create"]])]),default:r(()=>[i(L,{ref_key:"$table",ref:c,"query-items":s.value,"onUpdate:queryItems":a[0]||(a[0]=l=>s.value=l),"is-pagination":!0,columns:T,"get-data":e(b).getCategories},null,8,["query-items","get-data"]),i(j,{visible:e(f),"onUpdate:visible":a[6]||(a[6]=l=>H(f)?f.value=l:null),title:e(y),loading:e(n),onSave:a[7]||(a[7]=l=>e(F)(N))},{default:r(()=>[i(e(V),{ref_key:"modalFormRef",ref:I,"label-placement":"top","label-align":"left","label-width":80,model:e(o)},{default:r(()=>[i(e(g),{label:"父级分类",path:"parent_id"},{default:r(()=>[i(e(O),{value:e(o).parent_id,"onUpdate:value":a[1]||(a[1]=l=>e(o).parent_id=l),"key-field":"id","label-field":"name",options:$.value,"default-expand-all":"",disabled:_.value},null,8,["value","options","disabled"])]),_:1}),i(e(g),{label:"分类名称",path:"name",rule:{required:!0,message:"请输入分类名称",trigger:["input","blur"]}},{default:r(()=>[i(e(w),{value:e(o).name,"onUpdate:value":a[2]||(a[2]=l=>e(o).name=l),placeholder:"请输入分类名称，不能与现有分类名称重复",maxlength:"30","show-count":"",clearable:""},null,8,["value"])]),_:1}),i(e(g),{label:"分类别名",path:"alias",rule:{required:!0,message:"请输入分类别名",trigger:["input","blur"]}},{default:r(()=>[i(e(w),{value:e(o).alias,"onUpdate:value":a[3]||(a[3]=l=>e(o).alias=l),placeholder:"请输入分类别名，用于生成分类URL，不能与现有分类别名重复",maxlength:"50","show-count":"",clearable:""},null,8,["value"])]),_:1}),i(e(g),{label:"分类描述",path:"desc"},{default:r(()=>[i(e(w),{value:e(o).desc,"onUpdate:value":a[4]||(a[4]=l=>e(o).desc=l),type:"textarea",placeholder:"请输入分类描述"},null,8,["value"])]),_:1}),i(e(g),{label:"显示排序",path:"order"},{default:r(()=>[i(e(K),{value:e(o).order,"onUpdate:value":a[5]||(a[5]=l=>e(o).order=l),min:1},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading"])]),_:1},8,["title"]))}});export{be as default};
